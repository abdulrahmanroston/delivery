<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ•ÿØÿßÿ±ÿ© ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ™ŸàÿµŸäŸÑ - Tender Frozen</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #059669;
            --success-light: #10b981;
            --danger: #dc2626;
            --danger-light: #ef4444;
            --warning: #d97706;
            --warning-light: #f59e0b;
            --info: #0891b2;
            --info-light: #06b6d4;
            --light: #f8fafc;
            --dark: #0f172a;
            --background: #f1f5f9;
            --surface: #ffffff;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --whatsapp: #25D366;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient-primary: linear-gradient(135deg, #3b82f6, #1d4ed8);
            --gradient-success: linear-gradient(135deg, #10b981, #059669);
            --gradient-bg: linear-gradient(135deg, #f8fafc, #e2e8f0);
            --glass-bg: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] {
            --background: #0f172a;
            --surface: #1e293b;
            --border: #334155;
            --border-light: #475569;
            --light: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --gradient-bg: linear-gradient(135deg, #1e293b, #334155);
            --glass-bg: rgba(30, 41, 59, 0.8);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            direction: rtl;
            min-height: 100vh;
            font-size: 16px;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            min-height: 100vh;
            background: var(--gradient-bg);
            position: relative;
        }

        .app-container::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23e2e8f0" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            position: relative;
            z-index: 1;
            overflow: hidden;
            min-height: 100vh;
        }

        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(20px);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
            z-index: 2;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .header-actions {
            display: flex;
            gap: 12px;
            position: relative;
            z-index: 2;
        }

        .header-btn {
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 12px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .header-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .header-btn:hover::before {
            left: 100%;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .search-section {
            padding: 24px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            position: relative;
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border: 2px solid var(--border);
            border-radius: var(--border-radius-lg);
            font-size: 1rem;
            font-weight: 500;
            background: var(--surface);
            color: var(--text-primary);
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
            transform: translateY(-2px);
        }

        .search-icon {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .stats-grid {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: 5px;
            padding: 24px 10px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
        }

        .stat-card {
            width: 30%;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: var(--border-radius-lg);
            padding: 24px;
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: default;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .stat-card.success::before {
            background: var(--gradient-success);
        }

        .stat-card.warning::before {
            background: linear-gradient(135deg, var(--warning-light), var(--warning));
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 16px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow-md);
        }

        .stat-card.success .stat-icon {
            background: var(--gradient-success);
        }

        .stat-card.warning .stat-icon {
            background: linear-gradient(135deg, var(--warning-light), var(--warning));
        }

        .stat-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .tabs-container {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--border) transparent;
        }

        .tabs-container::-webkit-scrollbar {
            height: 4px;
        }

        .tabs-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .tabs-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            min-width: max-content;
        }

        .tab {
            padding: 16px 24px;
            cursor: pointer;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            font-size: 0.95rem;
            transition: var(--transition);
            color: var(--text-secondary);
            position: relative;
            white-space: nowrap;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary);
            opacity: 0;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            transition: opacity 0.3s ease;
        }

        .tab:hover:not(.active) {
            color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(37, 99, 235, 0.1);
        }

        .tab-count {
            background: var(--primary);
            color: white;
            border-radius: 20px;
            padding: 4px 10px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 8px;
            min-width: 24px;
            text-align: center;
        }

        .tab.active .tab-count {
            background: white;
            color: var(--primary);
        }

        .tab-content {
            display: none;
            padding: 24px;
            min-height: 400px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .orders-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .order-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            transition: var(--transition);
            position: relative;
            box-shadow: var(--shadow-sm);
        }

        .order-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 6px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .order-card:hover::before {
            transform: scaleY(1);
        }

        .order-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .order-header {
            padding: 20px 24px;
            background: linear-gradient(135deg, var(--light), var(--surface));
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .order-header:hover {
            background: linear-gradient(135deg, var(--border-light), var(--light));
        }

        .order-header-content {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            gap: 16px;
        }

        .order-info h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .order-id {
            color: var(--primary);
            font-weight: 800;
        }

        .order-total {
            color: var(--success);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .order-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .order-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .order-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            text-align: center;
            min-width: 100px;
            box-shadow: var(--shadow-sm);
        }

        .status-on-delivery {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
        }

        .status-delivered {
            background: linear-gradient(135deg, var(--success-light), var(--success));
            color: white;
        }

        .order-details {
            display: none;
            padding: 24px;
            background: var(--surface);
            animation: slideDown 0.3s ease;
        }

        .order-details.active {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 1000px; }
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .detail-section {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 20px;
            transition: var(--transition);
        }

        .detail-section:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
        }

        .section-title i {
            color: var(--primary);
            font-size: 1.2rem;
        }

        .detail-item {
            margin-bottom: 12px;
            font-size: 0.95rem;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            line-height: 1.5;
        }

        .detail-item i {
            color: var(--text-muted);
            margin-top: 2px;
            min-width: 16px;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-secondary);
            min-width: 80px;
        }

        .detail-value {
            color: var(--text-primary);
            flex: 1;
        }

        .detail-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .detail-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        .payment-alert {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
            color: #92400e;
            padding: 16px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
            box-shadow: var(--shadow-sm);
        }

        .payment-alert i {
            font-size: 1.2rem;
            color: #f59e0b;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 14px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .action-btn:active {
            transform: translateY(-1px);
        }

        .btn-call {
            background: linear-gradient(135deg, var(--success-light), var(--success));
            color: white;
        }

        .btn-map {
            background: linear-gradient(135deg, var(--danger-light), var(--danger));
            color: white;
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }

        .btn-delivered {
            background: linear-gradient(135deg, var(--info-light), var(--info));
            color: white;
        }

        .btn-start {
            background: linear-gradient(135deg, var(--warning-light), var(--warning));
            color: white;
        }

        .btn-report {
            background: linear-gradient(135deg, var(--warning-light), var(--warning));
            color: white;
        }

        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .no-orders {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .no-orders i {
            font-size: 4rem;
            color: var(--border);
            margin-bottom: 20px;
            display: block;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(8px);
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .loading-text {
            font-size: 1.1rem;
            font-weight: 500;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .distance-badge {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .route-indicator {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }

            .header {
                padding: 16px 20px;
                flex-direction: column;
                gap: 16px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header-actions {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .header-btn {
                padding: 10px 14px;
                font-size: 0.8rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                padding: 16px;
                gap: 16px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-value {
                font-size: 2rem;
            }

            .tabs-container {
                padding: 0 16px;
            }

            .tab {
                padding: 12px 16px;
                font-size: 0.85rem;
            }

            .tab-content {
                padding: 16px;
            }

            .order-header {
                padding: 16px 20px;
            }

            .order-header-content {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .order-info h3 {
                font-size: 1.1rem;
            }

            .details-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .actions-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .action-btn {
                padding: 12px 16px;
                font-size: 0.85rem;
            }

            .search-input {
                padding: 14px 18px 14px 45px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.25rem;
            }

            .header-btn {
                padding: 8px 12px;
                font-size: 0.75rem;
            }

            .stat-value {
                font-size: 1.75rem;
            }

            .order-info h3 {
                font-size: 1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .order-meta {
                flex-direction: column;
                gap: 8px;
            }

            .detail-section {
                padding: 16px;
            }

            .section-title {
                font-size: 1rem;
            }

            .detail-item {
                font-size: 0.9rem;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--border-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* SweetAlert2 Customization */
        .swal2-popup {
            font-family: 'Cairo', sans-serif !important;
            border-radius: var(--border-radius-lg) !important;
        }

        .swal2-input, .swal2-select {
            border-radius: var(--border-radius) !important;
            border: 2px solid var(--border) !important;
            font-size: 1rem !important;
            padding: 12px 16px !important;
        }

        .swal2-input:focus, .swal2-select:focus {
            border-color: var(--primary) !important;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1) !important;
        }

        .swal2-confirm {
            background: var(--gradient-primary) !important;
            border-radius: var(--border-radius) !important;
            font-weight: 600 !important;
        }

        .swal2-cancel {
            border-radius: var(--border-radius) !important;
            font-weight: 600 !important;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>
        </div>
    </div>

    <div class="app-container">
        <div class="container">
            <header class="header">
                <div class="header-content">
                    <div class="header-badge">Tender Frozen</div>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="theme-toggle" title="ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä/ÿßŸÑŸÜŸáÿßÿ±Ÿä">
                        <i class="fas fa-moon"></i>
                        <span>ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä</span>
                    </button>
                    <button class="header-btn" id="set-driver-settings" title="ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸÜÿØŸàÿ®">
                        <i class="fas fa-user-cog"></i>
                        <span>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                    </button>
                    <button class="header-btn" onclick="refreshOrders()" title="ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™">
                        <i class="fas fa-sync-alt"></i>
                        <span>ÿ™ÿ≠ÿØŸäÿ´</span>
                    </button>
                    <button class="header-btn" onclick="sendDeliveryReport()" title="ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ™ŸàÿµŸäŸÑÿßÿ™">
                        <i class="fas fa-file-alt"></i>
                        <span>ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±</span>
                    </button>
                </div>
            </header>

            <div class="search-section">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="order-filter" class="search-input" placeholder="ÿßÿ®ÿ≠ÿ´ ÿ®ÿ±ŸÇŸÖ ÿßŸÑÿ∑ŸÑÿ® ÿ£Ÿà ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ..." aria-label="ÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™">
                </div>
            </div>

            <div class="stats-grid" id="stats-grid"></div>

            <div class="tabs-container">
                <div class="tabs">
                    <button class="tab active" data-tab="on-delivery">
                        <span class="tab-count" id="on-delivery-count">0</span>
                        ŸÇŸäÿØ ÿßŸÑÿ™ŸàÿµŸäŸÑ
                    </button>
                    <button class="tab" data-tab="delivered">
                        <span class="tab-count" id="delivered-count">0</span>
                        ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ
                    </button>
                </div>
            </div>

            <div class="tab-content active" id="tab-on-delivery">
                <div class="orders-grid" id="orders-on-delivery"></div>
            </div>

            <div class="tab-content" id="tab-delivered">
                <div class="orders-grid" id="orders-delivered"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Configuration
        const CONFIG = {
            consumerKey: 'ck_f40406bbecba206fc13e711e2f8df86de26dbbc7',
            consumerSecret: 'cs_62458ae4d624c3a04a515c770345466497fd88a5',
            storeUrl: 'https://tenderfrozen.com',
            driverLocation: [30.231695, 31.501283],
            reportPhoneNumber: '+201123912175',
            refreshInterval: 900000
        };

        // Global State
        let orders = { 'on-delivery': [], delivered: [] };
        let deliveredTotal = 0;
        let distanceCache = JSON.parse(sessionStorage.getItem('distanceCache')) || {};
        let lastDeliveredLocation = null;

        // Utility Functions
        function showLoading() {
            document.getElementById('loading-overlay').classList.add('active');
        }

        function hideLoading() {
            requestAnimationFrame(() => {
                document.getElementById('loading-overlay').classList.remove('active');
            });
        }

        function showNotification(message, type = 'info', customIcon = null) {
            Swal.fire({
                title: type === 'success' ? 'ŸÜÿ¨ÿßÿ≠!' : type === 'error' ? 'ÿÆÿ∑ÿ£!' : type === 'warning' ? 'ÿ™ŸÜÿ®ŸäŸá!' : 'ŸÖÿπŸÑŸàŸÖÿßÿ™',
                text: message,
                icon: customIcon || type,
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: type === 'error' ? 5000 : 4000,
                timerProgressBar: true,
                customClass: {
                    popup: 'swal2-toast'
                },
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer);
                    toast.addEventListener('mouseleave', Swal.resumeTimer);
                }
            });
        }

        function showWelcomeMessage() {
            if (!localStorage.getItem('welcomeShown')) {
                Swal.fire({
                    title: 'üöö ŸÖÿ±ÿ≠ÿ®Ÿãÿß ÿ®ŸÉ ŸÅŸä ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ!',
                    html: `
                        <div style="text-align: right; line-height: 1.8;">
                            <p>Ÿáÿ∞ÿß ÿßŸÑŸÜÿ∏ÿßŸÖ ŸÖÿµŸÖŸÖ ÿÆÿµŸäÿµŸãÿß ŸÑÿ™ÿ≥ŸáŸäŸÑ  ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿ®ÿ≥ŸáŸàŸÑÿ© ŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ÿ™ŸàÿµŸäŸÑ Tender Frozen.</p>
                        </div>
                    `,
                    icon: 'info',
                    confirmButtonText: 'ŸÅŸáŸÖÿ™ÿå ŸÑŸÜÿ®ÿØÿ£!',
                    allowOutsideClick: false,
                    customClass: {
                        popup: 'welcome-popup'
                    }
                }).then(() => {
                    localStorage.setItem('welcomeShown', 'true');
                    setDriverSettings();
                });
            }
        }

        // Location and Distance Functions
        function extractLocation(order) {
            const meta = order.meta_data?.find(m => 
                m.key === '_billing_delivery_location' || 
                m.key === 'delivery_location'
            );
            const locationUrl = meta?.value || null;
            
            if (locationUrl && locationUrl.includes('google.com/maps?q=')) {
                try {
                    const coords = locationUrl.split('q=')[1].split(',');
                    const lat = parseFloat(coords[0]);
                    const lon = parseFloat(coords[1]);
                    if (isNaN(lat) || isNaN(lon)) return null;
                    return { coords: [lat, lon], url: locationUrl };
                } catch (e) {
                    console.error('Error extracting location:', e);
                    return null;
                }
            }
            return null;
        }

        function calculateDistance(coord1, coord2) {
            const cacheKey = `${coord1[0]},${coord1[1]}_${coord2[0]},${coord2[1]}`;
            if (distanceCache[cacheKey]) return distanceCache[cacheKey];

            const R = 6371; // Earth's radius in kilometers
            const dLat = (coord2[0] - coord1[0]) * Math.PI / 180;
            const dLon = (coord2[1] - coord1[1]) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(coord1[0] * Math.PI / 180) * Math.cos(coord2[0] * Math.PI / 180) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            let distance = R * c;

            // Apply correction factor
            const isUrban = coord2[0] > 29.9 && coord2[0] < 30.2 && coord2[1] < 31.1 && coord2[1] < 31.6;
            const correctionFactor = isUrban ? 1.3 : 1.15;
            distance *= correctionFactor;

            distanceCache[cacheKey] = distance;
            sessionStorage.setItem('distanceCache', JSON.stringify(distanceCache));
            return distance;
        }

        function getCurrentLocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve(CONFIG.driverLocation);
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const location = [position.coords.latitude, position.coords.longitude];
                        resolve(location);
                    },
                    (error) => {
                        resolve(CONFIG.driverLocation);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            });
        }

        // Order Management Functions
        function getPaymentAlert(paymentMethod) {
            const paymentMessages = {
                'Cash on delivery': {
                    message: 'ÿ™ŸÜÿ®ŸäŸá: ÿßŸÑÿØŸÅÿπ ÿπŸÜÿØ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ - ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿßŸÑŸÖÿ®ŸÑÿ∫ ŸÜŸÇÿØŸãÿß',
                    icon: 'fas fa-money-bill-wave'
                },
                'ase': {
                    message: 'ÿ™ŸÜÿ®ŸäŸá: ŸÑÿß ÿ™ŸÜÿ≥Ÿé ÿ•ÿ≠ÿ∂ÿßÿ± ŸÖÿßŸÉŸäŸÜÿ© ÿßŸÑŸÅŸäÿ≤ÿß ŸÑŸÑÿØŸÅÿπ',
                    icon: 'fas fa-credit-card'
                },
                'default': {
                    message: 'ÿ™ŸÜÿ®ŸäŸá: ÿ∑ÿ±ŸäŸÇÿ© ÿØŸÅÿπ ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØÿ© - ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ ŸÖÿπ ÿßŸÑÿπŸÖŸäŸÑ',
                    icon: 'fas fa-exclamation-circle'
                }
            };
            return paymentMessages[paymentMethod] || paymentMessages['default'];
        }

        function formatTime(date) {
            const hours = date.getHours();
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'ŸÖ' : 'ÿµ';
            const formattedHours = hours % 12 || 12;
            return `${formattedHours}:${minutes} ${ampm}`;
        }

        function formatPhoneNumber(phone) {
            if (!phone) return '';
            let cleaned = phone.trim().replace(/\s+/g, '').replace(/[^0-9+]/g, '');
            
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ£ÿµŸÅÿßÿ± ÿßŸÑÿ≤ÿßÿ¶ÿØÿ© ŸÖŸÜ ÿßŸÑÿ®ÿØÿßŸäÿ©
            if (cleaned.startsWith('00')) {
                cleaned = '+' + cleaned.substring(2);
            }
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ±ŸÖÿ≤ ŸÖÿµÿ± ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØ
            if (cleaned.startsWith('0') && cleaned.length === 11) {
                return '+20' + cleaned.substring(1);
            }
            if (cleaned.length === 10 && !cleaned.startsWith('+')) {
                return '+20' + cleaned;
            }
            if (cleaned.startsWith('+20')) {
                return cleaned;
            }
            
            return cleaned;
        }

        function saveOrderViewTime(orderId) {
            const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
            if (!orderData[orderId]) {
                orderData[orderId] = { viewTime: new Date().toISOString() };
                localStorage.setItem('orderData', JSON.stringify(orderData));
            }
            return orderData[orderId].viewTime;
        }

        function saveOrderStartTime(orderId) {
            const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
            if (!orderData[orderId]) {
                orderData[orderId] = {};
            }
            orderData[orderId].startTime = new Date().toISOString();
            localStorage.setItem('orderData', JSON.stringify(orderData));
        }

        function saveOrderDelivery(orderId, order, paymentType, paymentNote = '') {
            const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
            const billing = order.billing || {};
            const customerName = `${billing.first_name || ''} ${billing.last_name || ''}`.trim() || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';
            const deliveryTime = new Date().toISOString();
            const location = extractLocation(order);
            
            const existingData = orderData[orderId] || {};
            
            orderData[orderId] = {
                ...existingData,
                orderId: orderId,
                customerName: customerName,
                paymentMethod: order.payment_method_title || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ',
                total: parseFloat(order.total || 0).toFixed(2),
                viewTime: existingData.viewTime || new Date().toISOString(),
                deliveryTime: deliveryTime,
                deliveryLocation: location ? location.coords : null,
                deliveryLocationUrl: location ? location.url : null,
                paymentType: paymentType,
                paymentNote: paymentNote
            };
            
            localStorage.setItem('orderData', JSON.stringify(orderData));
            
            if (location) {
                lastDeliveredLocation = location.coords;
                localStorage.setItem('lastDeliveredLocation', JSON.stringify(lastDeliveredLocation));
            }
        }

        function removeMissingOrders(currentOrderIds) {
            const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
            const updatedOrderData = {};
            currentOrderIds.forEach(id => {
                if (orderData[id]) updatedOrderData[id] = orderData[id];
            });
            localStorage.setItem('orderData', JSON.stringify(updatedOrderData));
        }

        function filterOrdersByDriverPhone(orders, driverPhone) {
            const formattedDriverPhone = formatPhoneNumber(driverPhone);
            
            return orders.filter(order => {
                const meta = order.meta_data?.find(m => m.key === 'delivery_person_phone');
                if (!meta || !meta.value) return false;
                
                const deliveryPhone = formatPhoneNumber(meta.value);
                
                // ŸÖŸÇÿßÿ±ŸÜÿ© ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ ÿ®ÿπÿØÿ© ÿ∑ÿ±ŸÇ
                return deliveryPhone === formattedDriverPhone || 
                       deliveryPhone === driverPhone ||
                       deliveryPhone.replace('+20', '0') === driverPhone ||
                       deliveryPhone.replace('+20', '') === driverPhone.replace('0', '') ||
                       deliveryPhone === '+20' + driverPhone.replace('0', '');
            });
        }

        function sortOrdersByDistance(orders, startLocation) {
            if (!orders || orders.length === 0) return [];
            
            const ordersWithDistance = [];
            const ordersWithoutLocation = [];

            orders.forEach(order => {
                const location = extractLocation(order);
                if (location && location.coords && location.coords.length === 2) {
                    const distance = calculateDistance(startLocation, location.coords);
                    ordersWithDistance.push({
                        order,
                        location: location.coords,
                        locationUrl: location.url,
                        distance: distance,
                        routeInfo: 'ŸÖŸÜ ŸÜŸÇÿ∑ÿ© ÿßŸÑÿ®ÿØÿßŸäÿ©'
                    });
                } else {
                    ordersWithoutLocation.push({
                        order,
                        distance: Infinity,
                        locationUrl: null,
                        routeInfo: 'ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸàŸÇÿπ ŸÖÿ≠ÿØÿØ'
                    });
                }
            });

            ordersWithDistance.sort((a, b) => a.distance - b.distance);
            
            let currentLocation = startLocation;
            for (let i = 0; i < ordersWithDistance.length; i++) {
                if (i === 0) {
                    ordersWithDistance[i].distance = calculateDistance(currentLocation, ordersWithDistance[i].location);
                    ordersWithDistance[i].routeInfo = 'ŸÖŸÜ ŸÜŸÇÿ∑ÿ© ÿßŸÑÿ®ÿØÿßŸäÿ©';
                } else {
                    ordersWithDistance[i].distance = calculateDistance(
                        ordersWithDistance[i - 1].location, 
                        ordersWithDistance[i].location
                    );
                    ordersWithDistance[i].routeInfo = `ŸÖŸÜ ÿßŸÑÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿßÿ®ŸÇ (#${ordersWithDistance[i - 1].order.id})`;
                }
                currentLocation = ordersWithDistance[i].location;
            }

            return [...ordersWithDistance, ...ordersWithoutLocation];
        }

        // API Functions
        async function fetchOrders(silent = false) {
        const driverPhone = localStorage.getItem('driverPhone');
        if (!driverPhone) {
            displayEmptyState();
            if (!silent) showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅŸÉ ŸÅŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™', 'warning');
            hideLoading();
            return;
        }
        
        if (!silent) showLoading();
        
        try {
            const statuses = ['on-delivery', 'delivered'];
            const newOrders = { 'on-delivery': [], delivered: [] };
            deliveredTotal = 0;
            const allOrderIds = [];
            
            const currentLocation = await getCurrentLocation();
            const startLocation = CONFIG.driverLocation; // ÿßŸÑÿ™ÿπÿØŸäŸÑ ŸáŸÜÿß
            
            for (const status of statuses) {
                const url = `${CONFIG.storeUrl}/wp-json/wc/v3/orders?status=${status}&per_page=50`;
                    
                    try {
                        const response = await fetch(url, {
                            headers: {
                                'Authorization': 'Basic ' + btoa(`${CONFIG.consumerKey}:${CONFIG.consumerSecret}`)
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`API request failed with status ${response.status}`);
                        }

                        const data = await response.json();
                        
                        if (!Array.isArray(data)) {
                            throw new Error(`Unexpected response format for status ${status}`);
                        }

                        const filteredData = filterOrdersByDriverPhone(data, driverPhone);

                        const sortLocation = status === 'on-delivery' ? startLocation : currentLocation;
                        newOrders[status] = sortOrdersByDistance(filteredData, sortLocation);
                        allOrderIds.push(...filteredData.map(o => o.id));

                        if (status === 'delivered') {
                            deliveredTotal = filteredData.reduce((sum, order) => sum + parseFloat(order.total || 0), 0);
                        }
                    } catch (error) {
                        throw error;
                    }
                }

                removeMissingOrders(allOrderIds);

                const savedLastLocation = localStorage.getItem('lastDeliveredLocation');
                if (savedLastLocation) {
                    lastDeliveredLocation = JSON.parse(savedLastLocation);
                }

                orders = newOrders;
                displayStats();
                displayOrders();
                
                if (!silent) {
                    newOrders['on-delivery'].forEach(({ order }) => {
                        saveOrderViewTime(order.id);
                    });
                }

                if (silent && orders['on-delivery'].length > 0) {
                    showNotification('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©', 'info');
                }

                if (newOrders['on-delivery'].length === 0 && orders.delivered.length > 0) {
                    setTimeout(() => {
                        Swal.fire({
                            title: 'üéâ ÿ™ŸáÿßŸÜŸäŸÜÿß!',
                            text: 'ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™! ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿü',
                            icon: 'success',
                            showCancelButton: true,
                            confirmButtonText: 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±',
                            cancelButtonText: 'ŸÑÿßÿ≠ŸÇŸãÿß'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                sendDeliveryReport();
                            }
                        });
                    }, 1000);
                }
            } catch (error) {
                console.error('Error fetching orders:', error);
                
                if (!silent) {
                    showNotification(`ÿÆÿ∑ÿ£ ŸÅŸä ÿ¨ŸÑÿ® ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™: ${error.message}`, 'error');
                    displayErrorState(error.message);
                }
            } finally {
                hideLoading();
            }
        }

        // Display Functions
        function displayEmptyState() {
            document.getElementById('orders-on-delivery').innerHTML = `
                <div class="no-orders">
                    <i class="fas fa-user-cog"></i>
                    Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅŸÉ ŸÅŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™
                </div>
            `;
            document.getElementById('orders-delivered').innerHTML = `
                <div class="no-orders">
                    <i class="fas fa-user-cog"></i>
                    Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅŸÉ ŸÅŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™
                </div>
            `;
            document.getElementById('stats-grid').innerHTML = '';
        }

        function displayErrorState(errorMessage = '') {
            const message = errorMessage ? 
                `ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™: ${errorMessage}` : 
                'ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ - Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ';
            
            document.getElementById('orders-on-delivery').innerHTML = `
                <div class="no-orders">
                    <i class="fas fa-exclamation-triangle"></i>
                    ${message}
                </div>
            `;
            document.getElementById('orders-delivered').innerHTML = `
                <div class="no-orders">
                    <i class="fas fa-exclamation-triangle"></i>
                    ${message}
                </div>
            `;
        }

        function displayStats() {
            const statsContainer = document.getElementById('stats-grid');
            const totalOrders = orders['on-delivery'].length + orders.delivered.length;

            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div class="stat-title">ŸÇŸäÿØ ÿßŸÑÿ™ŸàÿµŸäŸÑ</div>
                    <div class="stat-value">${orders['on-delivery'].length}</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-title">ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ</div>
                    <div class="stat-value">${orders.delivered.length}</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="stat-title">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ŸÑŸÖ</div>
                    <div class="stat-value">${deliveredTotal.toFixed(2)} <small style="font-size: 0.6em;">ÿ¨ŸÜŸäŸá</small></div>
                </div>
            `;
        }

        function displayOrders() {
            const filter = document.getElementById('order-filter').value.toLowerCase();
            
            ['on-delivery', 'delivered'].forEach(status => {
                const container = document.getElementById(`orders-${status}`);
                const filteredOrders = orders[status].filter(({ order }) => {
                    const customer = `${order.billing?.first_name || ''} ${order.billing?.last_name || ''}`.toLowerCase();
                    return order.id.toString().includes(filter) || customer.includes(filter);
                });

                document.getElementById(`${status}-count`).textContent = filteredOrders.length;
                container.innerHTML = '';

                if (filteredOrders.length === 0) {
                    const emptyMessage = status === 'on-delivery' 
                        ? 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ŸÇŸäÿØ ÿßŸÑÿ™ŸàÿµŸäŸÑ' 
                        : 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ŸÖÿ≥ŸÑŸÖÿ©';
                    container.innerHTML = `
                        <div class="no-orders">
                            <i class="fas fa-${status === 'on-delivery' ? 'truck' : 'check-circle'}"></i>
                            ${emptyMessage}
                        </div>
                    `;
                    return;
                }

                filteredOrders.forEach(({ order, distance, locationUrl, routeInfo }, index) => {
                    const billing = order.billing || {};
                    const customerName = `${billing.first_name || ''} ${billing.last_name || ''}`.trim() || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';
                    const address = `${billing.address_1 || ''}, ${billing.city || ''}, ${billing.country || ''}`.trim().replace(/,+/g, ',') || 'ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±';
                    const products = order.line_items?.map(item => `${item.name} (x${item.quantity})`).join(', ') || 'ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±';
                    const paymentMethod = order.payment_method_title || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                    const paymentAlert = getPaymentAlert(paymentMethod);
                    const viewTime = saveOrderViewTime(order.id);

                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    orderCard.innerHTML = `
                        <div class="order-header" data-order-id="${order.id}">
                            <div class="order-header-content">
                                <div class="order-info">
                                    <h3>
                                        <span class="order-id">#${order.id}</span>
                                        ${customerName}
                                        <span class="order-total">${parseFloat(order.total || 0).toFixed(2)} ÿ¨ŸÜŸäŸá</span>
                                    </h3>
                                    <div class="order-meta">
                                        <div class="order-meta-item">
                                            <i class="fas fa-clock"></i>
                                            ÿßÿ≥ÿ™ŸÑŸÖ ŸÅŸä: ${formatTime(new Date(viewTime))}
                                        </div>
                                        ${distance !== Infinity ? `
                                            <div class="order-meta-item">
                                                <span class="distance-badge">
                                                    <i class="fas fa-route"></i>
                                                    ${distance.toFixed(2)} ŸÉŸÖ
                                                </span>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                                <div class="order-actions">
                                    <span class="order-status status-${status === 'on-delivery' ? 'on-delivery' : 'delivered'}">
                                        ${status === 'on-delivery' ? 'ŸÇŸäÿØ ÿßŸÑÿ™ŸàÿµŸäŸÑ' : 'ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ'}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="order-details" id="order-details-${order.id}">
                            <div class="details-grid">
                                <div class="detail-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-user"></i>
                                        ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿπŸÖŸäŸÑ
                                    </h4>
                                    <div class="detail-item">
                                        <i class="fas fa-user-circle"></i>
                                        <div class="detail-label">ÿßŸÑÿßÿ≥ŸÖ:</div>
                                        <div class="detail-value">${customerName}</div>
                                    </div>
                                    <div class="detail-item">
                                        <i class="fas fa-phone"></i>
                                        <div class="detail-label">ÿßŸÑŸáÿßÿ™ŸÅ:</div>
                                        <div class="detail-value">
                                            <a href="tel:${billing.phone}" class="detail-link">${billing.phone}</a>
                                        </div>
                                    </div>
                                    <div class="detail-item">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <div class="detail-label">ÿßŸÑÿπŸÜŸàÿßŸÜ:</div>
                                        <div class="detail-value">${address}</div>
                                    </div>
                                    ${locationUrl ? `.` : ''}
                                </div>

                                <div class="detail-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-box"></i>
                                        ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®
                                    </h4>
                                    <div class="detail-item">
                                        <i class="fas fa-money-bill-wave"></i>
                                        <div class="detail-label">ÿßŸÑÿØŸÅÿπ:</div>
                                        <div class="detail-value">${paymentMethod}</div>
                                    </div>
                                    <div class="detail-item">
                                        <i class="fas fa-calendar-alt"></i>
                                        <div class="detail-label">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ŸÑÿ®:</div>
                                        <div class="detail-value">${new Date(order.date_created).toLocaleDateString('ar-EG')}</div>
                                    </div>
                                </div>
                            </div>

                            ${paymentAlert ? `
                                <div class="payment-alert">
                                    <i class="${paymentAlert.icon}"></i>
                                    ${paymentAlert.message}
                                </div>
                            ` : ''}

                            ${status === 'on-delivery' && routeInfo ? `
                                <div class="route-indicator">
                                    <i class="fas fa-info-circle"></i>
                                    ${routeInfo}
                                </div>
                            ` : ''}

                            <div class="actions-grid">
                                <a href="tel:${billing.phone}" class="action-btn btn-call" title="ÿßÿ™ÿµŸÑ ÿ®ÿßŸÑÿπŸÖŸäŸÑ">
                                    <i class="fas fa-phone"></i>
                                    ÿßÿ™ÿµŸÑ ÿ®ÿßŸÑÿπŸÖŸäŸÑ
                                </a>
                                ${locationUrl ? `
                                
                                    <a href="${locationUrl}" target="_blank" class="action-btn btn-map" title="ÿπÿ±ÿ∂ ÿßŸÑŸÖŸàŸÇÿπ ÿπŸÑŸâ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ©" onclick="handleLocationClick(${order.id})">
                                    ÿπÿ±ÿ∂ ÿßŸÑŸÖŸàŸÇÿπ
                                    </a>
                                    
                                ` : ''}
                                <a href="https://wa.me/${formatPhoneNumber(billing.phone)}?text=${encodeURIComponent(`ŸÖÿ±ÿ≠ÿ®ÿß ${customerName}ÿå ŸÖŸÜÿØŸàÿ® ÿßŸÑÿ™ŸàÿµŸäŸÑ ŸÅŸä ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿ•ŸÑŸäŸÉ`)}" target="_blank" class="action-btn btn-whatsapp" title="ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ© Ÿàÿßÿ™ÿ≥ÿßÿ® ŸÑŸÑÿπŸÖŸäŸÑ">
                                    <i class="fab fa-whatsapp"></i>
                                    Ÿàÿßÿ™ÿ≥ÿßÿ®
                                </a>
                                ${status === 'on-delivery' ? `
                                    <button class="action-btn btn-delivered" onclick="confirmOrderStatus(${order.id})" title="ÿ™ÿ£ŸÉŸäÿØ ÿ™ÿ≥ŸÑŸäŸÖ ÿßŸÑÿ∑ŸÑÿ®">
                                        <i class="fas fa-check-circle"></i>
                                        ÿ™ŸÖ ÿßŸÑÿ™ŸàÿµŸäŸÑ
                                    </button>
                                ` : ''}
                                ${status === 'delivered' ? `
                                    <button class="action-btn btn-report btn-disabled" title="ŸÑÿß ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ•ÿ®ŸÑÿßÿ∫ ÿπŸÜ ÿ∑ŸÑÿ® ÿ™ŸÖ ÿ™ÿ≥ŸÑŸäŸÖŸá">
                                        <i class="fas fa-file-alt"></i>
                                        ÿ•ÿ®ŸÑÿßÿ∫
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    container.appendChild(orderCard);

                    orderCard.querySelector('.order-header').addEventListener('click', () => {
                        const details = orderCard.querySelector('.order-details');
                        details.classList.toggle('active');
                    });
                });
            });
        }

        function startMoving(orderId) {
            const order = orders['on-delivery'].find(o => o.order.id === orderId)?.order;
            if (!order) {
                showNotification('ÿßŸÑÿ∑ŸÑÿ® ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ!', 'error');
                return;
            }
            
            

            const billing = order.billing || {};
            const customerName = `${billing.first_name || ''} ${billing.last_name || ''}`.trim() || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';

            Swal.fire({
                title: 'üöö ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿ±ŸÉ',
                html: `
                    <div style="text-align: right; line-height: 1.8;">
                        <p><strong>ÿßŸÑÿ∑ŸÑÿ®:</strong> #${orderId}</p>
                        <p><strong>ÿßŸÑÿπŸÖŸäŸÑ:</strong> ${customerName}</p>
                        <p>ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿ±ŸÉ ŸÑŸáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ®ÿü</p>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'üöö ŸÜÿπŸÖÿå ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿ±ŸÉ',
                cancelButtonText: '‚ùå ÿ•ŸÑÿ∫ÿßÿ°',
                confirmButtonColor: '#f59e0b',
                cancelButtonColor: '#6b7280'
            }).then((result) => {
                if (result.isConfirmed) {
    const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ŸàŸÇÿ™ ÿ™ÿ≠ÿ±ŸÉ ŸÖÿ≥ÿ¨ŸÑ ŸÖÿ≥ÿ®ŸÇÿßŸã
    if (!orderData[orderId] || !orderData[orderId].startTime) {
        saveOrderStartTime(orderId);
        showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿ±ŸÉ ÿ®ŸÜÿ¨ÿßÿ≠!', 'success');
    } else {
        showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿ±ŸÉ ŸÖÿ≥ÿ®ŸÇÿßŸã', 'info');
    }
    
                    const driverName = localStorage.getItem('driverName') || 'ÿßŸÑŸÖŸÜÿØŸàÿ®';
                    const phone = formatPhoneNumber(billing.phone);
                    if (phone && phone.startsWith('+20')) {
                        const message = `ŸÖÿ±ÿ≠ÿ®ÿß ${customerName} üëã\n\nŸÖÿπ ÿ≠ÿ∂ÿ±ÿ™ŸÉ ${driverName}ÿå ŸÖŸÜÿØŸàÿ® ÿßŸÑÿ™ŸàÿµŸäŸÑ\nŸÑŸÇÿØ ÿ™ÿ≠ÿ±ŸÉÿ™ ÿßŸÑÿ¢ŸÜ ŸàŸÅŸä ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿ•ŸÑŸäŸÉ üöö\n\nÿßŸÑÿ∑ŸÑÿ® ÿ±ŸÇŸÖ: ${orderId}\nÿßŸÑŸÖÿ®ŸÑÿ∫: ${parseFloat(order.total || 0).toFixed(2)} ÿ¨ŸÜŸäŸá\n\nÿ¥ŸÉÿ±Ÿãÿß ŸÑÿ´ŸÇÿ™ŸÉŸÖ ŸÅŸä Tender Frozen ‚ùÑÔ∏è`;
                        const encodedMessage = encodeURIComponent(message);
                        window.open(`https://wa.me/${phone}?text=${encodedMessage}`, '_blank');
                    }
                }
            });
        }


function handleLocationClick(orderId) {
    // ÿ™ÿ≥ÿ¨ŸäŸÑ ŸàŸÇÿ™ ÿßŸÑÿ™ÿ≠ÿ±ŸÉ ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿπÿ±ÿ∂ ÿßŸÑŸÖŸàŸÇÿπ
    const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ŸàŸÇÿ™ ÿ™ÿ≠ÿ±ŸÉ ŸÖÿ≥ÿ¨ŸÑ ŸÖÿ≥ÿ®ŸÇÿßŸã
    if (!orderData[orderId] || !orderData[orderId].startTime) {
        saveOrderStartTime(orderId);
        
        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿ±ŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿπŸÜÿØ ÿπÿ±ÿ∂ ÿßŸÑŸÖŸàŸÇÿπ', 'info');
        
        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ© Ÿàÿßÿ™ÿ≥ÿßÿ® ŸÑŸÑÿπŸÖŸäŸÑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)
        const order = orders['on-delivery'].find(o => o.order.id === orderId)?.order;
        if (order) {
            const billing = order.billing || {};
            const customerName = `${billing.first_name || ''} ${billing.last_name || ''}`.trim() || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';
            const driverName = localStorage.getItem('driverName') || 'ÿßŸÑŸÖŸÜÿØŸàÿ®';
            const phone = formatPhoneNumber(billing.phone);
            
            if (phone && phone.startsWith('+20')) {
                const message = `ŸÖÿ±ÿ≠ÿ®ÿß ${customerName} üëã\n\nŸÖÿπ ÿ≠ÿ∂ÿ±ÿ™ŸÉ ${driverName}ÿå ŸÖŸÜÿØŸàÿ® ÿßŸÑÿ™ŸàÿµŸäŸÑ\nŸÑŸÇÿØ ÿ™ÿ≠ÿ±ŸÉÿ™ ÿßŸÑÿ¢ŸÜ ŸàŸÅŸä ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿ•ŸÑŸäŸÉ üöö\n\nÿßŸÑÿ∑ŸÑÿ® ÿ±ŸÇŸÖ: ${orderId}\nÿßŸÑŸÖÿ®ŸÑÿ∫: ${parseFloat(order.total || 0).toFixed(2)} ÿ¨ŸÜŸäŸá\n\nÿ¥ŸÉÿ±Ÿãÿß ŸÑÿ´ŸÇÿ™ŸÉŸÖ ŸÅŸä Tender Frozen ‚ùÑÔ∏è`;
                
                // ŸÅÿ™ÿ≠ Ÿàÿßÿ™ÿ≥ÿßÿ® ŸÅŸä ÿ™ÿßÿ® ÿ¨ÿØŸäÿØ ÿ®ÿØŸàŸÜ ÿ•ÿπÿßŸÇÿ© ŸÅÿ™ÿ≠ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ©
                setTimeout(() => {
                    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
                }, 1000);
            }
        }
    }
}




        function confirmOrderStatus(orderId) {
            const order = orders['on-delivery'].find(o => o.order.id === orderId)?.order;
            if (!order) {
                showNotification('ÿßŸÑÿ∑ŸÑÿ® ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ!', 'error');
                return;
            }

            const billing = order.billing || {};
            const customerName = `${billing.first_name || ''} ${billing.last_name || ''}`.trim() || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';

            Swal.fire({
                title: '‚úÖ ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ™ŸàÿµŸäŸÑ',
                html: `
                    <div style="text-align: right; line-height: 1.8;">
                        <p><strong>ÿßŸÑÿ∑ŸÑÿ®:</strong> #${orderId}</p>
                        <p><strong>ÿßŸÑÿπŸÖŸäŸÑ:</strong> ${customerName}</p>
                        <p><strong>ÿßŸÑŸÖÿ®ŸÑÿ∫:</strong> ${parseFloat(order.total || 0).toFixed(2)} ÿ¨ŸÜŸäŸá</p>
                        <br>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ:</label>
                            <select id="payment-type" class="swal2-select" style="width: 100%;">
                                <option value="cash">üíµ ÿØŸÅÿπ ŸÉÿßÿ¥</option>
                                <option value="visa">üí≥ ÿØŸÅÿπ ÿ®ÿßŸÑŸÅŸäÿ≤ÿß</option>
                                <option value="transfer">üè¶ ÿ∑ŸÑÿ®  ÿ™ÿ≠ŸàŸäŸÑ  ÿπŸÑŸä ÿßŸÑÿ≠ÿ≥ÿßÿ®</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">ŸÖŸÑÿßÿ≠ÿ∏ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿäÿ©):</label>
                            <textarea id="payment-note" class="swal2-textarea" placeholder="ÿ£ÿ∂ŸÅ ÿ£Ÿä ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©..." style="width: 100%; height: 80px; resize: vertical;"></textarea>
                        </div>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '‚úÖ ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ™ŸàÿµŸäŸÑ',
                cancelButtonText: '‚ùå ÿ•ŸÑÿ∫ÿßÿ°',
                confirmButtonColor: '#10b981',
                cancelButtonColor: '#ef4444',
                reverseButtons: true,
                preConfirm: () => {
                    const paymentType = document.getElementById('payment-type').value;
                    const paymentNote = document.getElementById('payment-note').value.trim();
                    return { paymentType, paymentNote };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    updateOrderStatus(orderId, result.value.paymentType, result.value.paymentNote);
                }
            });
        }

        async function updateOrderStatus(orderId, paymentType, paymentNote) {
            showLoading();
            try {
                const response = await fetch(`${CONFIG.storeUrl}/wp-json/wc/v3/orders/${orderId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'Basic ' + btoa(`${CONFIG.consumerKey}:${CONFIG.consumerSecret}`),
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status: 'delivered' }),
                });

                if (!response.ok) {
                    throw new Error('ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®');
                }

                const order = orders['on-delivery'].find(o => o.order.id === orderId)?.order;
                if (order) {
                    const billing = order.billing || {};
                    const customerName = `${billing.first_name || ''} ${billing.last_name || ''}`.trim() || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';
                    
                    saveOrderDelivery(orderId, order, paymentType, paymentNote);
                    sendDeliveryConfirmation(orderId, customerName, paymentType, paymentNote);
                }

                const remainingOrders = orders['on-delivery'].length - 1;
                const encouragementMessages = [
                    'üéØ ÿ£ÿ≠ÿ≥ŸÜÿ™! ÿ®ÿßŸÇŸä ' + remainingOrders + ' ÿ∑ŸÑÿ®ÿßÿ™!',
                    'üí™ ÿπŸÖŸÑ ÿ±ÿßÿ¶ÿπ! ' + remainingOrders + ' ÿ∑ŸÑÿ®ÿßÿ™ ŸÖÿ™ÿ®ŸÇŸäÿ©!',
                    '‚≠ê ŸÖŸÖÿ™ÿßÿ≤! ' + remainingOrders + ' ÿ∑ŸÑÿ®ÿßÿ™ ÿ£ÿÆÿ±Ÿâ!',
                    'üöÄ ÿßÿ≥ÿ™ŸÖÿ±! ' + remainingOrders + ' ÿ∑ŸÑÿ®ÿßÿ™ ŸÅŸÇÿ∑!',
                    'üî• ÿ±ÿßÿ¶ÿπ! ' + remainingOrders + ' ÿ∑ŸÑÿ®ÿßÿ™ ŸÖÿ™ÿ®ŸÇŸäÿ©!'
                ];

                let message = remainingOrders > 0
                    ? encouragementMessages[Math.floor(Math.random() * encouragementMessages.length)]
                    : 'üéâ ÿ±ÿßÿ¶ÿπ! ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ŸÑŸáÿ∞ÿß ÿßŸÑŸäŸàŸÖ! üèÜ';

                showNotification(message, 'success', 'üéâ');
                await fetchOrders(true);
            } catch (error) {
                console.error('Error updating order status:', error);
                showNotification(`ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }

        function sendDeliveryConfirmation(orderId, customerName, paymentType, paymentNote) {
            const now = new Date();
            const time = formatTime(now);
            const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
            const order = orderData[orderId];
            
            const paymentTypeText = {
                'cash': 'ŸÜŸÇÿØŸä',
                'visa': 'ŸÅŸäÿ≤ÿß',
                'transfer': 'ÿ™ÿ≠ŸàŸäŸÑ ÿπŸÑŸä ÿßŸÑÿ≠ÿ≥ÿßÿ®'
            };
            
            let message = `‚úÖ ÿ™ŸÖ ÿ™ŸàÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ±ŸÇŸÖ ${orderId} ÿ•ŸÑŸâ ÿßŸÑÿπŸÖŸäŸÑ ${customerName} ŸÅŸä ÿ™ŸÖÿßŸÖ ÿßŸÑÿ≥ÿßÿπÿ© ${time}\n\n`;
            message += `üí≥ ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ: ${paymentTypeText[paymentType] || paymentType}\n`;
            message += `üí∞ ÿßŸÑŸÖÿ®ŸÑÿ∫: ${order?.total || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'} ÿ¨ŸÜŸäŸá\n`;
            
            if (paymentNote) {
                message += `üìù ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ${paymentNote}\n`;
            }
            
            if (order && order.deliveryLocationUrl) {
                message += `üìç ŸÖŸàŸÇÿπ ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ: ${order.deliveryLocationUrl}\n`;
            }
            
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/${CONFIG.reportPhoneNumber}?text=${encodedMessage}`, '_blank');
            showNotification('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ™ŸàÿµŸäŸÑ ÿπÿ®ÿ± WhatsApp', 'success');
        }

        function generateDeliveryReport() {
            const orderData = JSON.parse(localStorage.getItem('orderData')) || {};
            const deliveredOrders = Object.values(orderData).filter(o => o.deliveryTime && o.orderId);
            
            let totalCashAmount = 0;
            let totalVisaAmount = 0;
            let totalTransferAmount = 0;
            
            deliveredOrders.forEach(order => {
                const amount = parseFloat(order.total) || 0;
                if (order.paymentType === 'cash') {
                    totalCashAmount += amount;
                } else if (order.paymentType === 'visa') {
                    totalVisaAmount += amount;
                } else if (order.paymentType === 'transfer') {
                    totalTransferAmount += amount;
                }
            });
            
            const totalCollectedAmount = totalCashAmount + totalVisaAmount;
            const remainingOrders = orders['on-delivery'].length;
            const driverName = localStorage.getItem('driverName') || 'ÿßŸÑŸÖŸÜÿØŸàÿ®';
            const today = new Date().toLocaleDateString('ar-EG');

            let report = `üìä *ÿ™ŸÇÿ±Ÿäÿ± ÿ™ŸàÿµŸäŸÑÿßÿ™ ${driverName}*\n`;
            report += `üìÖ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ: ${today}\n`;
            report += `‚è∞ ŸàŸÇÿ™ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±: ${formatTime(new Date())}\n`;
            report += `${'='.repeat(30)}\n\n`;

            if (deliveredOrders.length > 0) {
                report += `üì¶ *ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÖÿ≥ŸÑŸÖÿ© (${deliveredOrders.length}):*\n\n`;
                
                deliveredOrders.forEach((order, index) => {
    // ÿ™ÿ≠ŸàŸäŸÑ ÿ±ŸÖÿ≤ ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ ÿ•ŸÑŸâ ŸÜÿµ ÿπÿ±ÿ®Ÿä
    const paymentTypeText = {
        'cash': 'üíµ ŸÜŸÇÿØŸä',
        'visa': 'üí≥ ŸÅŸäÿ≤ÿß',
        'transfer': 'üè¶ ÿ™ÿ≠ŸàŸäŸÑ ÿπŸÑŸä ÿßŸÑÿ≠ÿ≥ÿßÿ®'
    };
    
    report += `${index + 1}. *ÿßŸÑÿ∑ŸÑÿ® #${order.orderId || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}*\n`;
    report += `üë§ ÿßŸÑÿπŸÖŸäŸÑ: ${order.customerName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}\n`;
    if (order.startTime) {
        report += `üöö ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿ±ŸÉ: ${formatTime(new Date(order.startTime))}\n`;
    }
    report += `‚úÖ ÿ™ÿ≥ŸÑŸäŸÖ: ${formatTime(new Date(order.deliveryTime))}\n`;
   //  report += `üí≥ ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ ŸÅŸä : ${order.paymentMethod || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}\n`;
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ ÿßŸÑŸÅÿπŸÑŸäÿ© ÿßŸÑÿ™Ÿä ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ±Ÿáÿß
    if (order.actualPaymentMethod) {
        report += `üí∞ ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ ÿßŸÑŸÅÿπŸÑŸäÿ©: ${paymentTypeText[order.actualPaymentMethod] || order.actualPaymentMethod}\n`;
    }
    
    report += `üí∞ ÿßŸÑŸÖÿ®ŸÑÿ∫: ${order.total || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'} ÿ¨ŸÜŸäŸá\n`;
    
    if (order.paymentNote) {
        report += `üìù ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ${order.paymentNote}\n`;
    }
    
    if (order.deliveryLocationUrl) {
        report += `üìç ŸÖŸàŸÇÿπ ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ: ${order.deliveryLocationUrl}\n`;
    }
    
    report += `${'-'.repeat(20)}\n`;
});

                report += `\nüí∞ *ŸÖŸÑÿÆÿµ ÿßŸÑŸÖÿ®ÿßŸÑÿ∫:*\n`;
                if (totalCashAmount > 0) {
                    report += `üíµ ŸÜŸÇÿØŸä: ${totalCashAmount.toFixed(2)} ÿ¨ŸÜŸäŸá\n`;
                }
                if (totalVisaAmount > 0) {
                    report += `üí≥ ŸÅŸäÿ≤ÿß: ${totalVisaAmount.toFixed(2)} ÿ¨ŸÜŸäŸá\n`;
                }
                if (totalTransferAmount > 0) {
                    report += `üè¶ ÿ∑ŸÑÿ® ÿ™ÿ≠ŸàŸäŸÑ ÿπŸÑŸä ÿßŸÑÿ≠ÿ≥ÿßÿ®: ${totalTransferAmount.toFixed(2)} ÿ¨ŸÜŸäŸá\n`;
                }
                report += `üí∞ *ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿ™ÿ≥ŸÑŸäŸÖŸá: ${totalCollectedAmount.toFixed(2)} ÿ¨ŸÜŸäŸá*\n\n`;
            } else {
                report += `‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≥ŸÑŸäŸÖ ÿ£Ÿä ÿ∑ŸÑÿ®ÿßÿ™ ÿ®ÿπÿØ\n\n`;
            }

            if (remainingOrders > 0) {
                report += `‚è≥ *ÿ∑ŸÑÿ®ÿßÿ™ ŸÖÿ™ÿ®ŸÇŸäÿ©: ${remainingOrders}*\n\n`;
            } else {
                report += `üéâ *ÿ™ŸÖ ÿ•ŸÜÿ¨ÿßÿ≤ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™!*\n\n`;
            }

            report += `üì± ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ŸÖŸÜ ŸÜÿ∏ÿßŸÖ Tender Frozen\n`;
            report += `üïê ${new Date().toLocaleString('ar-EG')}`;

            return report;
        }

        function sendDeliveryReport() {
            const driverPhone = localStorage.getItem('driverPhone');
            const driverName = localStorage.getItem('driverName') || 'ÿßŸÑŸÖŸÜÿØŸàÿ®';

            if (!driverPhone || !driverName) {
                showNotification('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ŸàÿßŸÑÿßÿ≥ŸÖ ŸÅŸä ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', 'warning');
                return;
            }

            Swal.fire({
                title: 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ™ŸàÿµŸäŸÑÿü',
                text: `ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÇÿ±Ÿäÿ± ŸÖŸÅÿµŸÑ ÿ•ŸÑŸâ ${CONFIG.reportPhoneNumber}`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'ŸÜÿπŸÖÿå ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±',
                cancelButtonText: 'ÿ•ŸÑÿ∫ÿßÿ°'
            }).then((result) => {
                if (result.isConfirmed) {
                    const report = generateDeliveryReport();
                    const encodedMessage = encodeURIComponent(report);
                    window.open(`https://wa.me/${CONFIG.reportPhoneNumber}?text=${encodedMessage}`, '_blank');
                    showNotification('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                }
            });
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        function toggleTheme() {
            const currentTheme = localStorage.getItem('theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        function setDriverSettings() {
            Swal.fire({
                title: 'ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖŸÜÿØŸàÿ®',
                html: `
                    <div style="text-align: right;">
                        <label style="display: block; margin-bottom: 8px;">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿØŸàÿ®:</label>
                        <input type="text" id="driver-name" class="swal2-input" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ" value="${localStorage.getItem('driverName') || ''}">
                        <label style="display: block; margin-top: 16px; margin-bottom: 8px;">ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅ ÿßŸÑŸÖŸÜÿØŸàÿ®:</label>
                        <input type="tel" id="driver-phone" class="swal2-input" placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅŸÉ (ŸÖÿ´ÿßŸÑ: 01111358504)" value="${localStorage.getItem('driverPhone') || ''}">
                        <small style="color: #666; font-size: 0.85em;">Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ±ŸÇŸÖ ŸÉŸÖÿß ŸáŸà ŸÖÿ≥ÿ¨ŸÑ ŸÅŸä ÿßŸÑŸÜÿ∏ÿßŸÖ</small>
                    </div>
                `,
                confirmButtonText: 'ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
                preConfirm: () => {
                    const driverName = document.getElementById('driver-name').value;
                    const driverPhone = document.getElementById('driver-phone').value;
                    return { driverName, driverPhone };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.setItem('driverName', result.value.driverName);
                    localStorage.setItem('driverPhone', result.value.driverPhone);
                    showNotification('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    fetchOrders();
                }
            });
        }

        function refreshOrders() {
            fetchOrders();
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);

            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            document.getElementById('set-driver-settings').addEventListener('click', setDriverSettings);
            document.getElementById('order-filter').addEventListener('input', displayOrders);

            // Add tab switching functionality
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    
                    tab.classList.add('active');
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`tab-${tabId}`).classList.add('active');
                });
            });

            const savedLastLocation = localStorage.getItem('lastDeliveredLocation');
            if (savedLastLocation) {
                lastDeliveredLocation = JSON.parse(savedLastLocation);
            }

            fetchOrders();
            showWelcomeMessage();

            setInterval(() => fetchOrders(true), CONFIG.refreshInterval);
        });
    </script>
</body>
</html>
